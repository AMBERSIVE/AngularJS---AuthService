!function(a,b,c){"use strict";angular.module("ambersive.auth",["ambersive.rest","ambersive.helper","ui.router"]),angular.module("ambersive.auth").run(["$rootScope","$state","$stateParams","AuthSrv","IdentitySrv",function(a,b,c,d,e){a.$state=b,a.$stateParams=c,a.toState=b,a.toStateParams=c,a.$on("$stateChangeStart",function(b,c,e){a.toState=c,a.toStateParams=e,d.authorize()}),a.$on("Identity",function(b,c){a.identity=c.identity})}]),angular.module("ambersive.auth").provider("$identitySettings",[function(){var a="auth/current",b="/401",c="app.error",d="",e="",f=function(b){a=b},g=function(a){b=a},h=function(a){c=a},i=function(a){d=a},j=function(a){e=a};return{setAuthentificationUrl:f,setRedirectUrlOnLogged:i,setRedirectRouteOnLogged:j,setRedirectUrlOnAccessDenied:g,setRedirectRouteOnAccessDenied:h,$get:function(){return{authenticationUrl:a,urlDenied:b,routeDenied:c,urlLogged:d,routeLogged:e}}}}]),angular.module("ambersive.auth").factory("IdentitySrv",["$q","$log","$rootScope","$identitySettings","RestSrv","HelperSrv",function(a,b,d,e,f,g){var h,i={},j=e;return i.current=function(){return h},i.isIdentityResolved=function(){return angular.isDefined(_identity)},i.isAuthenticated=function(){return h!==c&&null!==h&&""!==h?!0:!1},i.isInRole=function(a){return h===c||null===h?!1:h.roles?-1!=h.roles.indexOf(a):!1},i.isInAnyRole=function(a){if(!a)return!1;var b=a.length;if(0===b)return!1;for(var c=0;b>c;c++)if(i.isInRole(a[c]))return!0;return!1},i.isInAnyRoleGlobal=function(){if(h===c||null===h)return!1;if(!h.roles)return!1;var a=h.roles,b=a.length;if(0===b)return!1;for(var d=0;b>d;d++)if(i.isInRole(a[d]))return!0;return!1},i.get=function(b){b===c&&(b=j);var e=a.defer(),k={method:"GET",url:b.authenticationUrl,header:{}};return g.cookies.get("accessToken",function(a){a!==c&&""!==a&&(k.header[f.config.auth.tokenName]=a),f.call(k,function(a){if(401===a.status)h=null;else{var b=a.data;b.data!==c&&(b=b.data),h=b}e.resolve(h),d.idenity=h,d.isAuthenticated=i.isAuthenticated()})}),e.promise},i.settings={get:function(a){return j===c?null:j[a]===c?null:j[a]},set:function(a,d){return j===c?(b.error("_ItentitySettings is undefined"),null):void(j[a]=d)}},i}]),angular.module("ambersive.auth").factory("AuthSrv",["$q","$log","$window","IdentitySrv","$identitySettings","$rootScope","$state",function(a,b,d,e,f,g,h){var i={};return i.isAuthenticated=function(){return e.isAuthenticated()},i.getUrlOrRoute=function(a){var b="",c=!0,d="",e="";switch(a){case"logged":d="urlLogged",e="routeLogged";break;default:d="urlDenied",e="routeDenied"}return b=f[d],""!==f[e]&&(b=f[e],c=!1),{path:b,isUrl:c}},i.authorize=function(a){return e.get(a).then(function(a){var b=e.isAuthenticated(),f=[],j=[],k=0,l=i.getUrlOrRoute("denied"),m=i.getUrlOrRoute("logged"),n=null,o=function(){if(n!==c&&null!==n)switch(typeof n){case"object":if(n.route!==c&&""!==m.route)return void h.go(n.route);n.url!==c&&""!==n.url&&(d.location.href=n.url);break;case"boolean":n===!0&&(m.isUrl===!0?""!==m.path&&(d.location.href=m.path):""!==m.path&&h.go(m.path))}};null!==a&&a.roles!==c&&(f=a.roles),g.toState!==c&&g.toState.data!==c&&(g.toState.data.roles!==c&&(j=g.toState.data.roles,k=j.length),g.toState.data.redirectOnLogged!==c&&(n=g.toState.data.redirectOnLogged)),k>0&&!e.isInAnyRole(j)?l.isUrl===!0?""!==l.path&&(d.location.href=l.path):""!==l.path&&h.go(l.path):b===!0&&n!==c&&o(),g.$broadcast("Identity",{identity:a})})},i}])}(window,document,void 0);